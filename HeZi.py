from logzero import logger

star = 'Èñµ'

"""
    §çΩ	§ëî k,v  ÂºÇ‰ΩìÂ≠ó\tÊú¨‰ΩìÂ≠ó
    HeZi[§ëî]=HeZi[§çΩ] if §çΩ in §ëî
    HeZi[v]=HeZi[k] if k in v
    """
doc = open("YiTiZi/YiTiZi.txt").read().splitlines()
YiTiZi = [x.split('\t') for x in doc]

path = "ChaiZi/ChaiZi.txt"
doc = open(path).read().splitlines()
ChaiZi = [x.split('\t') for x in doc]
# HeZi = {k:v for k,v in ChaiZi }


def split(dic0, JiZi, YiTi, epoch=0):
    giveup = set()
    dic1 = {}
    for k, v in dic0.items():
        if k == star:
            d = 0
        if k in giveup:
            continue
        if v in JiZi:
            dic1[k] = v
            continue
        u = ''
        for x in v:
            w = dic0[x]
            if w not in JiZi:
                w = YiTi.get(w, w)
                if epoch >= 5:
                    giveup.add(k)
                    # logger.info((k, v))
            u += w.strip()
        dic1[k] = u
        for x in giveup:
            if x in dic1:
                del dic1[x]
    logger.info(f"giveup:{len(giveup)} {''.join(giveup)}")
    base0 = set(''.join(x for x in dic0.values()))
    base1 = set(''.join(x for x in dic1.values()))
    logger.info((f"epoch:{epoch} base:{len(base0)} --> {len(base1)} "))
    return dic1


def chai(vocab_path, tgt, base_path):
    HeZi = {k: v for k, v in ChaiZi}
    JiZi = open(vocab_path).read().splitlines()
    JiZi = [x for x in JiZi if x]
    JiZi = set(JiZi)
    for x in JiZi:
        HeZi[x] = x

    YiTi = {}
    for k, v in YiTiZi:
        if k == star:
            d = 0  # 'Â∏Ω'  Â±ÇÊ¨°ÊãÜÂ≠ó Êñ∞ÊûÑ‰ª∂
        if k in JiZi and v in JiZi:
            continue
        if k in JiZi and v not in JiZi:
            k = v
        YiTi[k] = v

    for k, v in YiTi.items():
        if v not in HeZi:  # vÁΩïËßÅ
            k, v = v, k
        if v not in HeZi:  # vÁΩïËßÅ
            logger.warning((k, v))
            continue
        if k in JiZi:
            continue
        if k in HeZi[v]:  # Êõ¥ÁªÜ
            HeZi[v] = HeZi[k]
        if v in HeZi:
            # if k < v:
            # logger.warning((k, v))
            HeZi[k] = HeZi[v]
        elif k in HeZi:  # None
            # logger.info((k, v)
            continue

    dic0 = {k: v for k, v in HeZi.items() if k and v}

    for i in range(8):
        dic1 = split(dic0, JiZi, YiTi, epoch=i)
        dic0 = dic1

    dic0 = {k: v for k, v in dic0.items() if k and v}

    base0 = list(set(''.join(x for x in dic0.values())))
    base0.sort()
    with open(base_path, "w") as f:
        for x in base0:
            f.write(x+'\n')
    logger.info(''.join(set(base0)-JiZi))  #
    logger.info((JiZi-set(base0)))

    chars = list(dic0)
    chars.sort()
    with open(tgt, "w") as f:
        for x in chars:
            l = f"{x}\t{dic0[x]}"
            f.write(l+'\n')


if __name__ == "__main__":
    chai("JiZi/JiZi.txt", "HeZi/He2Ji.txt", "HeZi/BaseJi.txt")
    chai("YuanZi/YuanZi.txt", "HeZi/He2Yuan.txt", "HeZi/BaseYuanZi.txt")

"""
[I 220625 06:41:43 HeZi:43] giveup:0 
[I 220625 06:41:43 HeZi:46] epoch:0 base:12943 --> 9945 
[I 220625 06:41:44 HeZi:43] giveup:0 
[I 220625 06:41:45 HeZi:46] epoch:1 base:9945 --> 9831 
[I 220625 06:41:45 HeZi:43] giveup:0 
[I 220625 06:41:46 HeZi:46] epoch:2 base:9831 --> 9831 
[I 220625 06:41:51 HeZi:43] giveup:318 ¨æπ£ê¶®ΩÖ°ôû≠Æñ≠á©¶áµ≠ªä≠ñ≤≠ΩÅ£∫ô≠á¢•Ñ§¢äá≠´ø£•ãÂ¨Ω£è±´∏™Æöä¶îÄ¶£©°üºÆØÜ≠Åê•≠ø¨Ñí≠±©„ÇäÆ¨ø´ììÆÖè™ä©†∞á£ìù¨ªë®≠§¢ã±Æîá‚ë´≠Ä£‚ë£¨ã¢†≥ßß∑ß´íØ©Éä¢èª‚ÑìÁéà•®ó¨ÖÖ©ÉÖ‚ë≠Æ§©£∏∞´ëÉÔºüßÇò°ÖÅ†åö¨éù≠ø•¨ùÇ´¥¢≠ºæ†ç©
¶áÖ£§ù‚ë®©çΩ¨ÉÖ¢®ñ®ìÇ®ñÆ™≠î¨ª±Æóô•ëØ≠Öç≠¨¢≠±êÆáì‚ë¨†ãê©åÆÆ¢á´©ä¨óã≠ê•®∞î†¨£Æúü®îï≠•ü„Ç≥°êùÆÉûÆì†ßòß´∫Ñ¨øª≠ê£¢∫¨‚ñ≥≠Ω∂°Ñâ°öÖß¶ÆÆîúÆî∞Æë©´öÉ¶Æµ‚ëÆÆûÖ≠≤û™¶æ®òÑÔøΩ†∞°‚ë¶‚ë¶‚ë†‚ë•£∏ºßüæ≠°à™†à‚ëØ≠¥∫Ó†ó£û¶¶¶û£™ÉßøóÆé≥†≤Å°Ωº£ß±™¶Ç§ÇÉ£¥Å§Åú†®¶§¥ò≠Åü•æ≥Êåî≠≥õ≠§™Æïã≠æäßÉ±°öáßÜï†ó©
≠£û¶∞å§âê‚Üî¨ªû´§µ™ëÑ´∏Ä≠ΩÇ≠µàÆì¢§úì≠Ü±‰Æâßü∫™íì≠è¨©Ñπ≠±Ω¢Å§≠ê¢¶Ø§¢èæ°ô™¨¨¢‚ë™ÆÆ°¶∑†¶óâ¶çñ≠∫∫§ï¶≠Ä•†∞üÆ£ù∞®á≠Æ¥§≤±§èë®±∏°££¨ºóß±ÜßÖç≠ä∞≠¨ç§å∞¨ªò´ëÄ≠Ü¥°ÖìÔøΩ†ê´≠©ü§Ω™†Üó´π≤≠©≤†Üã‚ë©‚ë©ß¥á≠ö°ßÅÅ®Ñõ¢â∫•íõ™Çó†™ï„Çµ¢á≠Œ±†ÖÇÆ°≠∞≤û≠£ï´≠£Æ°™≠¶¢ßïî≠ôß°ØºÆíø¢Åé≠µÑ„É®≠¶Å 
„ÇàÆ≠π£≠åõÇ¶†Üñ¶£µ°©ù•ÆÇ≠≥ò¨úª‚ë§•üÉ¶òé≠£™≠§ã£∫è≠Ñê≠∂Ç®Äî≠™öÆíÆ„ÅÑßìÇ†ùâ≠±éßë∫•ÑΩ£ß∫¨Öå§ãõ‚Ü∑¶°ø™õÉ©õñÆàè°≠≥≠õÑ§®ÉÆÑ£≠îå§••¢Æ¥¨ª•‚ë≤≠≥©Æ£®¢ê∏‚ë°®üß´è¶£ëõß°â¶™¥¶ñ∂≠©©©éá‚ëß§£ß°ã¨£ç´≠≠ß≠î•£ó´‚ë¢∞í•„¢≥´´±≠ôô≠ú§¨î®ß±ä©•úß∑Ñ§îû†éñß°ï
[I 220625 06:41:52 HeZi:46] epoch:3 base:9831 --> 9799 
[I 220625 06:41:53 HeZi:43] giveup:0 
[I 220625 06:41:54 HeZi:46] epoch:4 base:9799 --> 9799 
[I 220625 06:41:54 HeZi:99] 
[I 220625 06:41:54 HeZi:100] set()


[I 220625 06:43:45 HeZi:43] giveup:0 
[I 220625 06:43:45 HeZi:46] epoch:0 base:8203 --> 2609 
[I 220625 06:43:46 HeZi:43] giveup:0 
[I 220625 06:43:47 HeZi:46] epoch:1 base:2609 --> 1774 
[I 220625 06:43:47 HeZi:43] giveup:0 
[I 220625 06:43:48 HeZi:46] epoch:2 base:1774 --> 1760 
[I 220625 06:43:49 HeZi:43] giveup:0 
[I 220625 06:43:49 HeZi:46] epoch:3 base:1760 --> 1760 
[I 220625 06:43:50 HeZi:43] giveup:0 
[I 220625 06:43:51 HeZi:46] epoch:4 base:1760 --> 1760 
[I 220625 06:44:03 HeZi:43] giveup:1137 †®ûËµó¢ã±Êì≥Ê¥ä©ï¥¨™ô≠ªä¢â∫¢Ø´¢®ñ¢≤Ñ≠∂ÇÂÜî°†ÑÂ≤õ£ìç©Éä´≤Éß∑Ñ¨∏¥´Ñç≠ò≤‰êö™ú•ÈØΩ∞Çø≠°à°•Ç¶çñ§£ß„ê≠´òô™≠î≠Åü≠•üÆöê´â©¨ä∑Âáõ£πÇ„ë°†òêÈÅ∞≠µÑÆîÇ•õ£°úí§Äô≠Ä£„Çµ®Ç¢Èöù¶™¥Â∏ΩÂ´ãÂÜïß°â§çæÈ≥≥†ìÆ°πô§Ç∂§ëáÔøΩ¢Ç£•æ≥¨ùã∞ú¨∞òÄ§ÇÉ°ÑÅÆ¢á„É®„É®†©ªØ†±™âä¢∫¨ÂÜí¢§≠®±∏¶ÄíÊºπ„ÅÑÊãµßÇΩÂ¨Ö„õø´≠£Ëê∫Âãñ§≥©≠ûñØ†≥°Öì≠¨¢°æ≠ÆÖè¨ÑúÈ≥¨¶áÖ®™á•®ó®∫£Æ¨ê†Üø£ëä™™®™ä©Ø†∞¶™†Â∂å°É¶¶†úÂîß°ö£´∏º≠Æ¥†éë†àöÁÄÑ§É¢±Ä†§äµÁöç•≠ø´®¨£©É†ï¶£ù≤Ëûê•á≥„íü†ùâ°´é†≠Ç§ëì≠≤≥Áá£Æ°™´ïù†ãê°àò≠ú§´¥ò¶°ø®óº∞Ç∂ÔøΩ†èµ§èë¨∑∂„Çä„Çä®è∏≠á¢ÆÑ£ÆîáÊ™©•üÉØ¢Ü£öùß¥á´ñõ„∫∫®ΩÖ¨ä•Êßù¨ºóÁºé¶Ø§°â†õÇ¶°†π¶äØßÆâ„Æß©èá¶¶∞≠óÉ£©ô≠ø•Âñû©Äµ©æè¨ÉÖ¶æõË∫èÁÑâÆ£ù°ª∫†•ñ¢ã¥ÁÖÖ‚ë§Æë©„íΩ¢èªßÖç°ë©©ÉÖ„†è§ìü§••Ë∫™¶∞å†©Øßë∫„†Ä„†Ä≠∫∫ß†Å‰ó°Âáú´Ñä„¶äÈçõÁ¢´ÈöØ´ßô•à®¨ªò®îï™†Ç∞≠ç§íê≠ê¢®∂á™¶Ç®∂Ñ§ãõ°≠≥©•úÈÉª
´ìì†íéÁéàÁéà‰Öø¶¶∫®èº´Æñ†éñÆ¨ø´∂á£éÆÁ®ü†ôí£∫è∞∏õ„ôøß∑ß≠å®∞ìöËâú††ë¶Ωè´¶≤¶õä≠§ã¨Ü∏©æñ§¥ò´è¶≠øñßìÇ„®∂¶æì°ªÖ‰∏ùÂóö≠ΩÅÂçø§ëéßÑü§ûê©ºö≠åü≠Ω∂£∫ô„∏ëßí¨Ëî∫™àΩ´âø£∏∞•©¥≠¶¢∞õ§¶á©Æò•®òõÆîï°©ùÂ£∑Ê™Å¶òé£¥Å„±≠Â™¢¶£©Ë¢Ö®â®©ãã®ΩñÆ§©ÂπØ©æì¢≠è´™Æ¨∂é£øÜÊ´õ¶∫ü¶∑†Ëé≠†Ω†≠°£ßëç
Æ°≠§Ü°≠öê≠Ü¥Ô•îÈñµ¨æπÁØ∂•ªº¨Ø∂„°å™Ñù„´Ø©çΩ´ÉÖ∞∏∏Á¶Äßúµ¶∫ÑÂá´¶Ç∞†ç©©øã§ìö¢Ñì•ÆÇ®úë®©©¢∂ë¨î®≠±ê≠ä∞†èü©åµÂÜÉ™ûå°ºÑÁá®¢ù™°†ø†å∂Ø£≠¢§ª∞∫£†Ü°©º§Ø†ØÊªØ•õµ´°øÂú®•£Æ°öñ¢ê∏‰≥ã∞å¨∞ßøßü∫™£ãË§≠¨ªë‰ôä¢Ωµ∞Ñï±áµ°∫ë≠åæ§ö∂°££≠±©ÊâóÁñÑ©æí•íõ§éÑ≠Äã≠î•¢∫´∞¨ú≠ªù§í¢™æÖ†ïö•≤≠ 
Â†≤§âê´©ä≠ñ∏ÊÖ∏¨úª£ó´≠º™¢∏£©∫ÄÆöäÁÑ®‚ë´†∞°ËüÇ´∫Ñ†°ò°ôû°∑ä®óç‚ë°§ì•†∞á´≤âËπ∏§πÑ§¢§Ôß∞°ññ†Åë†≤ÅÈ∞øÊáòŒ±´ÉñÂÇø∞∏≤†∞ü¢ä∏Ø°ñ„Øõ¶èÅÁû±™¶≠Â¥ºËùçË†û®©∑©Ñπ≠Åê°ÄÄ®üß®¨ã‚Üî†Ç∂§∏º¶Çî¶µçÈ∑®Ó†ó≠ìÅ†ïôÆú©ÁëÅ£ëõ¨êëßãç™ºØ¨íõ≠õÑ¢∞ÇÆíø£πúÈ∞ûÂ∏∞´´±∞Öª´¶±®í∏®ìÇ¢ê±¨ã¢Áëñ¢ØæÊç£†õÜ†ûÜ
•§Ü£™É°Ñâ∞Åø®ò¨®úáÂª©©Üê´ûå•âº≠µàÔ™≠£î∫™Çó‚ë≠°ô™£õ¨≠ê•†∞±†åµ°ñ•´∫ÜÆîí§™ß©åó´ãáÂΩí§Ω™‰°ß¨¨¢ÊêóÆÉû©§£Èîª™¶ã®Ü¥®∫ú©èß≠è¨‚ë•„íªÊæü£¶®Ê®∫§≤∞™°∞°íÑ£§ù£ªâ∞üÄ¶ÆµËå¨´ñ§ß±Ü™µï≠©üÊ§¥≠≤ù°è≠£û¶¨ÖÖÆáìÈü°§®É´íø≠£û≠©≤±àØÈ≥ß„Ç≥°ÖÅ§íπ´π≤ÆØÜ§áü¶¶û°ø¢§äª≠ªü´ëæÂªóÈÑ¢°Ωº¢õ°∞°πÔøΩÆî∞´öÉÔ®©Ô®©©êØ¨áµÂò©ß¶Æ£ü¶†ÜñØ§†®∫ΩÊåî≠∏õ´î¥©¶´£Ü±Ë≠Å¶ã§†åö‰ÇÄ©ºø®ìº°êù¢¥∂´õì¨ÅãÈäØËçêËëÆ†ÖÇ®ÆçÊÆµÔ¶é†ê´‚ë®©å¥Â≥∂¢ôÆ†∑å´Ω≤£ØÄ®é∫≠´ø†Üó¨ã°•ïßËùÉËπõ‰ñö£ÑíØ†≤≠ÇõØß•∞∞è¨ª•ßπÆ™≥¶ßÅÅ†™ï≠§™‰âÆ£ê¶¶ΩπÁäß¢Ñ©ßüæ≠îå©áÜÊ¢üÈ≤´°âà¢§î£ùÑ¢èæÆîú´ëÄÁÜì‰åØß±ä≠ñò≠¶ÅÁØÄ§ï¶∞èï‚ñ≥
•ëØ®ñÆ°¨ú∞ëµÁôù≠≠ò§≤±ßΩû„•º§Øë†ó©≠Ü©†°º≠™öÈüâ£üäÆ£®®∞î†®††±ú°áæ•†å§àä•Ñ§™¨¢≠≠ß•ãüÊáç†Üã≠¨çË∫ô®∂±Áèî™∑§®û¥Æé≥£éã¢Ω¢©Æü™éêÆïã®≠§Êì£™ëÑÆì¢´üÅØ¢ΩÁôõ¶®ß¢êØ©ê≤ÂµΩÊØà™•ÄØ¶õ†å•ÈüÄ¨ÖåßΩãßÇ∂∞èº™≤í„¶¢´∞°È¥µ≠£ï†òÖ©ºúÂ°ÖÈ∑ç∞Ø≥£ç´¶îÄ†ï•¢ä¨≠æä•§Ç©åÆÊè§„úµ´®ª™Øú´≤≥¢ãèÔøΩ§æ§Ê§õÊ§õ´ë¥£≠å„Øä©æ£†™ÖßÉπ≠ºæßøó¢Ö¶§è∑„†°‰ï≤°Ä´Ëî´¢ÅéËùê§Åú¨Çã´∑Ä∞≤ûÁà®©úù†≥ß≠ΩÇÈÑ•ßÜï¶æè‚ëØ‚ë©ßÇò•ÑΩ®òÑ∞øüÈ∏∂§îû¢∂∏∞ªÆ∞í•‰††‚Ñì£∏º¢∂à¨øªÂòïÆÉ¶´ùµ¢æü™¶æ¶óâ¨Äò¢¢ê≠≥õÆì††ì∂°ñ™„¥ò„¥ò†®ç¶ÜöÂª™ß°ïÂ¨ù©é∂¨ª±≠ö°§°î‰æü‰Æâ‚Ü∑Â¨Ω†ïñÁ∑ûÔ©ñ™õÉ≠∏ûÂç≥¨Ñí≠≤û„ØÇÂ´££±≠¶Ä©‰¢ú 
†¨£∞®á©º±£ª¥≠±Ω¶¢µË≥µ¢ä£≠ê£Ø§ú§∂ê†µÑÊû≠ß∑ÉÂ∑ã™íì£è±§ä≥Ø£í†ï¨Ôºü§ëñÊõ¶¨éù‚ë¶¶æ∞‚ëÆ®Ä¨°üº®ö≤Êæï´íØ´ûº¨óã∞≤ü¢∑ç™ÉëßãÉ§£Ω™†àÂ£∫®≥Ä¨ü†∞ííÔ™¥°öÖ‰Éµ¢Öä´öòÂ£à§å∞∞ºæ¨°á¢Æ¥©ªÆ≠∏Ø≠Æñß†äÈäå¶áµ≠ô∫‚ë¨¢Å§∞ß¨‰ëµÁµª®û∂≠Ü±‰óª§é≠Âíù®üè£∂ÄÁá∑¢á≠¶∑äÂÜê†®¶ßïî©à∫•ã∂©è¨©ñã´∏™®£Ñ™Ωú
∞úä¶∂Ä£®º©õñ∞áò®éπ¶¶æ¶≥ìÂ≥å•öïßù•®≠∑©ù∑£πã™Ω¶¢∑≠¨õã„òâÂ∂π¢≥ÉÂ∏¥„±ïÁæ≤¶™∑„©ò°ªúÈÑ°¶éÆ¶ª∫°Øº£°ë°ã¨´¥¢¢ÄÆ¶ø¨¢û¨ÊÆ¢¨ö≠©éÇ≠ôôÁÉè®∫Ü¨í¢Æúü´ëö¶ºá≠±é´ø£™ºö•±≥Áàî£•ã™ü•ÆïπÂÜë¢à∫§¥üÆíÆ°ñ†≠à≠≠≥©¨ùÇ‰ôöÆÆ°Ë£ä∞∏öËûÆÆîôËÖ∂©™∂§´à∞äé¢ãï´≥ñÂ∂ã†≥≤Ë¢∏≠≤∞£åÄÂ°¢∞ûç‰≤∑„µØÁë¶ÔøΩßû°„¢≥„¢≥£å∏§∫°•óó•†à≠Ä•©éáÂ∏∂∞©Å©ã¶®ôå£òñ∞èì„¶ÖÈ°≤‚ë™±àù°π≠∞ªÜ¶ñ∂¨ªû§≤à§úì§æè£ß±„íæ†òü„Çàßõï´Çµ†ª≠¶ãì≠ñ≤£ÅöËó∫¶ÜâÁÜ∂≠á©‚ë†Â≠òÊáî´åà≠©©‰≤ô†ïÆ¶£µ¨©û≠≥òÊúÇ‰óñÊ†´‚ë¢Â≤ø°öá†ò°ßéö„¨¢™ã¥≠£®ÆûÖËΩ•®Äî„üÜ¢äá¶ºπ‚ë≤¢Ä§Ê∫©Ø£ì®úäÆá≠¢ùå£ê©¢§Ö„íøÂµ®ËèØ°ìîßÇëßòß≠ÖçØßä≠¥∫¢∑¨°óã
´∏ÄÆàè£ìù„™ûÁ∏ÄÂôù£ª•„∏ÖßÉ±®ÑõËá∂´§µ≠≤Ä°àå•††‚ëß´øù©ãæ∞îáÈûØ°ÄÆ¨ëìßöá≠£™®∫î•ûò•úòÊØ∑¢≥öÈé¢¨ö¶∞ñ©Êëï¢µ¥£ß∫¶°£®è¶≠ÑêÆóôÆßµ≠éØÆë®∞ìú©âæ´èó´≠áËâíßëÇ
[I 220625 06:44:04 HeZi:46] epoch:5 base:1760 --> 1719 
[I 220625 06:44:04 HeZi:43] giveup:0 
[I 220625 06:44:05 HeZi:46] epoch:6 base:1719 --> 1719 
[I 220625 06:44:06 HeZi:43] giveup:0 
[I 220625 06:44:07 HeZi:46] epoch:7 base:1719 --> 1719 
[I 220625 06:44:07 HeZi:99] 
[I 220625 06:44:07 HeZi:100] set()
"""
